<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Happy Birthday Prasansha!</title>
  <link href="https://fonts.cdnfonts.com/css/winky-rough" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@700&family=Montserrat:wght@400;700&display=swap" rel="stylesheet"/>
  <style>
    * { box-sizing: border-box; }
    @import url('https://fonts.googleapis.com/css2?family=Zilla+Slab:ital,wght@0,700;1,700&display=swap');

    .welcome-message {
      position:fixed;
      top:50%;
      left:50%;
      transform:translate(-50%,-50%);
      font-family: 'Zilla Slab', serif;
      font-weight: 700;
      font-size:2.5em;
      color:#e84393;
      text-shadow:2px 2px 4px rgba(0,0,0,0.3);
      opacity:0;
      z-index:100;
      pointer-events:none;
    }

    @media (max-width: 768px) {
      body {
        justify-content: flex-start;
        padding: 10px 0;
        overflow-y: auto;
      }
      #wish-text:disabled {
        opacity: 0.6;
        cursor: not-allowed;
      }
      
      .container {
        padding: 15px;
        margin-top: 20px;
      }
      
      .memory-gallery {
        gap: 10px;
        margin-bottom: 20px;
      }
      
      .memory-item {
        width: 45%;
        height: 120px;
      }
    }

    body::before {
      content: '';
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: 
        radial-gradient(circle at 20% 80%, rgba(232, 67, 147, 0.1) 0%, transparent 50%),
        radial-gradient(circle at 80% 20%, rgba(255, 107, 107, 0.1) 0%, transparent 50%),
        radial-gradient(circle at 40% 40%, rgba(157, 78, 221, 0.1) 0%, transparent 50%);
      animation: gentlePulse 8s ease-in-out infinite;
      pointer-events: none;
      z-index: 0;
    }

    @keyframes gentlePulse {
      0%, 100% { opacity: 0.5; }
      50% { opacity: 0.8; }
    }

    .shooting-star {
      position: fixed;
      width: 4px;
      height: 4px;
      background: white;
      border-radius: 50%;
      box-shadow: 0 0 10px 2px white;
      opacity: 0;
      z-index: 1;
      animation: shootStar 3s ease-out forwards;
    }

    @keyframes shootStar {
      0% {
        transform: translate(0, 0) rotate(0deg);
        opacity: 1;
      }
      100% {
        transform: translate(100vw, 100vh) rotate(360deg);
        opacity: 0;
      }
    }

    h1 {
      margin-bottom: 20px !important;
    }

    body {
      margin:0; padding:0;
      font-family:'Montserrat',sans-serif;
      text-align:center;
      transition:background-color 0.5s;
      min-height:100vh;
      display:flex;
      flex-direction:column;
      justify-content:flex-start;
      align-items:center;
      background:#121212;
      color: #e0e0e0;
      overflow-x:hidden;
      position: relative;
      padding: 20px 0;
    }

    .container { 
      max-width:800px; 
      width:95%; 
      padding:20px; 
      position:relative; 
      z-index:10;
      margin: auto;
    }

    #gift-button {
      display: none;
      opacity: 0;
      transition: opacity 1s ease;
      padding: 12px 25px;
      border: none;
      border-radius: 25px;
      background: linear-gradient(45deg, #ff6b6b, #e84393);
      color: white;
      font-weight: bold;
      font-size: 1.1em;
      cursor: pointer;
      box-shadow: 0 4px 15px rgba(255,107,107,0.3);
      user-select:none;
      margin: 10px auto;
    }

    #gift-button:hover {
      background: linear-gradient(45deg, #e84393, #ff6b6b);
      box-shadow: 0 6px 20px rgba(0,0,0,0.4);
    }

    #memories-button, #show-memories-button {
      background: linear-gradient(45deg, #0984e3, #74b9ff);
      display: none;
      padding: 10px 22px;
      border: none;
      border-radius: 20px;
      color: white;
      font-weight: 600;
      cursor: pointer;
      box-shadow: 0 3px 12px rgba(9,132,227,0.3);
      user-select:none;
      margin: 10px auto;
    }
    
    #lightbox-modal {
      display: none;
      position: fixed;
      top: 0; left: 0;
      width: 100vw; height: 100vh;
      background: rgba(0, 0, 0, 0.9);
      z-index: 1000;
      justify-content: center;
      align-items: center;
      flex-direction: column;
    }

    #lightbox-content img, 
    #lightbox-content video {
      max-width: 90%;
      max-height: 80vh;
      border-radius: 10px;
      box-shadow: 0 0 15px rgba(255, 255, 255, 0.3);
    }

    #memories-button:hover, #show-memories-button:hover {
      background: linear-gradient(45deg, #74b9ff, #0984e3);
    }

    .cake-container {
      position: relative;
      display: none;
      margin: 20px 0 30px 0;
      z-index: 5;
      cursor: pointer;
    }

    .cake {
      width: 180px;
      height: 100px;
      background: linear-gradient(to bottom, #f9c5d1, #f8a5c2);
      border-radius: 10px 10px 0 0;
      position: relative;
      margin: 0 auto;
      box-shadow: 0 10px 20px rgba(0,0,0,0.3);
    }

    .cake:before {
      position: absolute;
      content: '';
      top: -10px;
      left: -10px;
      width: 200px;
      height: 20px;
      background: linear-gradient(to right, #f999b7, #f67eaa);
      border-radius: 10px;
      box-shadow: 0 5px 10px rgba(0,0,0,0.2);
    }

    .candle {
      width:8px;
      height:40px; 
      background:linear-gradient(to bottom,#fff,#f0f0f0);
      position:absolute; 
      top:-45px;
      left:50%; 
      transform:translateX(-50%);
      border-radius:5px; 
      cursor:pointer; 
      box-shadow:0 2px 5px rgba(0,0,0,0.2);
    }

    .flame {
      width:12px;
      height:25px; 
      background:radial-gradient(#ffef00,#ff9e00);
      position:absolute; 
      top:-25px;
      left:50%; 
      transform:translateX(-50%);
      opacity:0; 
      border-radius:50% 50% 20% 20%; 
      filter:blur(1px);
      box-shadow:0 0 20px #ff6600,0 0 40px #ff9900;
    }
    .flame.burning { 
      opacity:1; 
      animation:flicker 0.5s infinite alternate; 
    }
    @keyframes flicker {
      0% { opacity:1; transform:translateX(-50%) scale(1); }
      100% { opacity:0.8; transform:translateX(-50%) scale(1.1); }
    }
    .birthday-message {
      font-size:1.1em; 
      color:#e0e0e0; 
      background:rgba(30,30,30,0.8);
      padding:20px; 
      border-radius:15px; 
      margin:20px 0; 
      max-width:90%;
      box-shadow:0 5px 15px rgba(0,0,0,0.3); 
      display:none; 
      line-height:1.6;
      white-space: pre-wrap;
      border: 1px solid #444;
    }
    .memory-gallery {
      display:none; 
      margin-top:20px; 
      flex-wrap:wrap; 
      justify-content:center; 
      gap:15px;
    }
    .memory-item {
      width:150px;
      height:150px;
      background:#2a2a2a;
      border-radius:12px;
      overflow:hidden;
      display:flex;
      justify-content:center;
      align-items:center;
      transition:all .3s;
      box-shadow:0 5px 15px rgba(0,0,0,0.3);
      border: 1px solid #444;
    }
    .memory-item:hover {
      transform:scale(1.05); 
      box-shadow:0 10px 25px rgba(0,0,0,0.4); 
      z-index:2;
    }
    .memory-item img, .memory-item video {
      width:100%; 
      height:100%; 
      object-fit:cover; 
      transition:transform .3s;
    }
    h1 {
      font-family: 'Winky Rough', cursive; 
      font-size:2.2em; 
      color:#e84393;
      text-shadow:2px 2px 4px rgba(0,0,0,0.3); 
      margin:0;
      margin-bottom: 40px !important;
    }
    #bg-music, #tum-hi-ho-music { display:none; }
    .balloon, .confetti, .floating-heart { 
      position:absolute; 
      z-index:1; 
    }
    .balloon {
      width:50px;
      height:70px;
      border-radius:50%; 
      opacity:0;
      animation:float 8s ease-in-out infinite;
      box-shadow:inset -5px -5px 10px rgba(0,0,0,0.2);
    }
    .balloon:before {
      content:''; 
      position:absolute; 
      bottom:-40px; 
      left:50%; 
      width:2px;
      height:40px;
      background:#444; 
      transform:translateX(-50%);
    }
    @keyframes float {
      0%,100%{transform:translateY(0)}50%{transform:translateY(-40px) rotate(5deg);}
    }
    .balloon.red{background:radial-gradient(circle at 30% 30%,#ff6b6b,#e84393);}
    .balloon.blue{background:radial-gradient(circle at 30% 30%,#74b9ff,#0984e3);}
    .balloon.green{background:radial-gradient(circle at 30% 30%,#55efc4,#00b894);}
    .balloon.yellow{background:radial-gradient(circle at 30% 30%,#ffeaa7,#fdcb6e);}
    .balloon.purple{background:radial-gradient(circle at 30% 30%,#a29bfe,#6c5ce7);}
    .confetti {
      width:8px; 
      height:8px; 
      animation:confetti-fall 3s linear forwards;
    }
    @keyframes confetti-fall {
      0% { transform:translateY(-100vh); opacity:1; }
      100% { transform:translateY(100vh); opacity:0; }
    }
    .floating-heart {
      font-size:18px; 
      color:#ff6b6b; 
      animation:float-up 4s ease-in forwards;
    }
    @keyframes float-up {
      0% { transform:translateY(0); opacity:1; }
      100% { transform:translateY(-100vh) rotate(360deg); opacity:0; }
    }
    .party-overlay {
      position:fixed;
      top:0;
      left:0;
      width:100%;
      height:100%;
      background:rgba(255,255,255,0.05);
      backdrop-filter:blur(2px);
      z-index:3;
      display:none;
      pointer-events:none;
    }
    .fade-in { animation:fadeIn 1s forwards; }
    .fade-out { animation:fadeOut 1s forwards; }
    @keyframes fadeIn {
      from { opacity:0; transform:translate(-50%,-50%) scale(.8); }
      to { opacity:1; transform:translate(-50%,-50%) scale(1); }
    }
    @keyframes fadeOut{
      from {opacity:1;}
      to {opacity:0;}
    }
    #start-overlay {
      position: fixed;
      top:0; left:0;
      width:100%; height:100%;
      background: #121212;
      z-index: 9999;
      display:flex;
      justify-content:center;
      align-items:center;
      cursor:pointer;
      font-family: 'Dancing Script', cursive;
      font-size: 1.8em;
      color: #e84393;
      user-select:none;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
    }

    @keyframes bounceFadeIn {
      0% {
        opacity: 0;
        transform: translateY(20px) scale(0.9);
      }
      50% {
        opacity: 1;
        transform: translateY(-10px) scale(1.05);
      }
      100% {
        opacity: 1;
        transform: translateY(0) scale(1);
      }
    }

    #gift-button.show {
      display: inline-block;
      animation: bounceFadeIn 1s ease forwards;
      opacity: 1;
    }

    #wish-container {
      display: none;
      margin: 20px auto;
      max-width: 90%;
    }
    
    #wish-text {
      width: 100%;
      padding: 15px;
      border-radius: 15px;
      border: 1px solid #444;
      background: rgba(30,30,30,0.8);
      color: #e0e0e0;
      font-family: 'Montserrat', sans-serif;
      font-size: 1em;
      margin-bottom: 15px;
      resize: none;
      min-height: 100px;
    }
    
    #submit-wish {
      padding: 12px 25px;
      border: none;
      border-radius: 25px;
      background: linear-gradient(45deg, #e84393, #ff6b6b);
      color: white;
      font-weight: bold;
      font-size: 1.1em;
      cursor: pointer;
      box-shadow: 0 4px 15px rgba(255,107,107,0.3);
      margin: 0 auto;
      display: block;
    }
    
    #submit-wish:hover {
      background: linear-gradient(45deg, #ff6b6b, #e84393);
    }
    
    #wish-message {
      display: none;
      color: #ff6b6b;
      font-weight: bold;
      margin-top: 15px;
      text-align: center;
    }
    .cake-sparkle {
      position: absolute;
      width: 6px;
      height: 6px;
      background: gold;
      border-radius: 50%;
      opacity: 0;
      animation: sparkle 2s ease-in-out infinite;
    }

    @keyframes sparkle {
      0%, 100% { opacity: 0; transform: scale(0); }
      50% { opacity: 1; transform: scale(1); }
    }
    
    .heart-pulse {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 4em;
      opacity: 0;
      z-index: 999;
      pointer-events: none;
      animation: heartPulse 2s ease-out forwards;
    }
    
    @keyframes heartPulse {
      0% { transform: translate(-50%, -50%) scale(0); opacity: 0; }
      50% { opacity: 1; }
      100% { transform: translate(-50%, -50%) scale(3); opacity: 0; }
    }
    
    @media (max-width: 600px) {
      h1 {
        font-size: 1.8em;
        margin-bottom: 30px !important;
      }
      .cake {
        width: 150px;
        height: 80px;
      }
      .cake:before {
        width: 170px;
      }
      .birthday-message {
        font-size: 1em;
        padding: 15px;
      }
      .memory-item {
        width: 130px;
        height: 130px;
      }
      .welcome-message {
        font-size: 2em;
      }
    }
    
    @media (max-width: 400px) {
      h1 {
        font-size: 1.5em;
        margin-bottom: 25px !important;
      }
      .memory-item {
        width: 100px;
        height: 100px;
      }
      #gift-button, #memories-button, #show-memories-button, #submit-wish {
        padding: 10px 20px;
        font-size: 1em;
      }
    }
    #bg-music, #tum-hi-ho-music { display:none; }
  </style>
</head>
<body>
  <div id="start-overlay">Tap to Start 🎉</div>
  <div class="container">
    <h1 id="typing-text">👸 Happy Birthday Prasansha!</h1>
    <div class="cake-container" id="cake-container" title="Click the cake to light the candle">
      <div class="candle"><div class="flame"></div></div>
      <div class="cake"></div>
    </div>
    <button id="gift-button">A simple gift for you</button>
    <button id="memories-button">Message</button>
    <div class="birthday-message" id="birthday-message"></div>
    <button id="show-memories-button">Memories</button>
    <div class="memory-gallery" id="memory-gallery"></div>
    
    <div id="wish-container">
      <textarea id="wish-text" placeholder="Type your wish here..."></textarea>
      <button id="submit-wish">Send Your Wish (3 left)</button>
      <p id="wish-message"></p>
    </div>
  </div>
  <div id="balloons-container"></div>
  <div class="party-overlay" id="party-overlay"></div>
  
  <div class="welcome-message" id="welcome-message-1">Hi Cutiepie</div>
  <div class="welcome-message" id="welcome-message-2">Gulumulu</div>
  <div class="welcome-message" id="welcome-message-3">Cupcake</div>
  <div class="welcome-message" id="welcome-message-4">Dumpling</div>
  <div class="welcome-message" id="welcome-message-5">I know it's unexpected</div>
  
  <div id="lightbox-modal" style="display:none; position:fixed;top:0;left:0;width:100vw;height:100vh; background:rgba(0,0,0,0.9); z-index:1000; justify-content:center; align-items:center; flex-direction: column;">
    <button id="lightbox-close" style="position:absolute;top:20px;right:20px; font-size:1.5em; background:rgba(30,30,30,0.7); border:none; color:white; cursor:pointer; width:40px; height:40px; border-radius:50%; display:flex; justify-content:center; align-items:center;">✖</button>
    <button id="lightbox-prev" style="position:absolute;top:50%;left:20px; transform:translateY(-50%); font-size:2em; background:rgba(30,30,30,0.7); border:none; color:white; cursor:pointer; width:40px; height:40px; border-radius:50%; display:flex; justify-content:center; align-items:center;">◀</button>
    <div id="lightbox-content" style="max-width:90vw; max-height:80vh; display:flex; justify-content:center; align-items:center;">
    </div>
    <button id="lightbox-next" style="position:absolute;top:50%;right:20px; transform:translateY(-50%); font-size:2em; background:rgba(30,30,30,0.7); border:none; color:white; cursor:pointer; width:40px; height:40px; border-radius:50%; display:flex; justify-content:center; align-items:center;">▶</button>
  </div>

  <div id="final-message" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.9); z-index:2000; justify-content:center; align-items:center; flex-direction:column; color:white; font-family:'Montserrat', sans-serif; font-size:1.8em; text-align:center; padding:20px; line-height:1.6;">
    <button id="close-final-message" style="position:absolute; top:20px; right:20px; background:none; border:none; color:white; font-size:1.5em; cursor:pointer; z-index:2001;">✖</button>
    <p style="font-weight:300; letter-spacing:1px;">No matter where life takes us...</p>
    <p style="font-size:1.3em; margin-top:20px; font-weight:400; color:#ff6b6b;">You'll always have a special place in my heart 💖</p>
    <p style="font-size:0.9em; margin-top:30px; opacity:0.8;">- Forever</p>
  </div>

  <div id="final-question" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.95); z-index:2000; justify-content:center; align-items:center; flex-direction:column; color:#ff6b6b; font-family:'Montserrat', sans-serif; font-size:1.8em; text-align:center; padding:20px; line-height:1.5;">
    <button id="close-final-question" style="position:absolute; top:20px; right:20px; background:none; border:none; color:white; font-size:1.5em; cursor:pointer; z-index:2001;">✖</button>
    <p style="font-weight:500; text-shadow: 0 0 10px rgba(255,107,107,0.3);">Kya tum firse wo purana "haan ji" wala Prasansha banogi?</p>
    <p style="font-size:0.8em; margin-top:20px; opacity:0.8; font-weight:300;">(Will you be my Mam once again?)</p>
  </div>

  <audio id="bg-music" loop preload="auto">
    <source src="https://dl.dropboxusercontent.com/scl/fi/k4wo5sv2tetuos0zrcy21/audio.mp3?rlkey=ilhqqk19hlmw50iad0enp7vh3&dl=1" type="audio/mpeg"/>
  </audio>
  
  <!-- Tum Hi Ho Music Element -->
  <audio id="tum-hi-ho-music" preload="auto">
    <source src="https://dl.dropboxusercontent.com/scl/fi/j55hmo1c8mll6rgo0loak/Tum-Hi-Ho-Aashiqui-2-Karaoke-Version.m4a?rlkey=ggbeo5fpm66tr941b8dbp7thr&st=ra2ut3c9&dl=1" type="audio/mpeg"/>
  </audio>
  
  <script>
    // Mobile autoplay workaround
    document.addEventListener('DOMContentLoaded', function() {
      let audioUnlocked = false;
      
      const unlockAudio = () => {
        if (audioUnlocked) return;
        
        const bgMusic = document.getElementById('bg-music');
        const tumHiHoMusic = document.getElementById('tum-hi-ho-music');
        
        // Create a silent audio context to unlock audio on mobile
        const silentAudio = new Audio();
        silentAudio.src = 'data:audio/wav;base64,UklGRigAAABXQVZFZm10IBAAAAABAAEARKwAAIhYAQACABAAZGF0YQQAAAAAAA==';
        silentAudio.volume = 0;
        
        silentAudio.play().then(() => {
          audioUnlocked = true;
          silentAudio.pause();
          silentAudio.remove();
        }).catch(() => {});
      };
      
      // Unlock audio on any user interaction
      document.addEventListener('click', unlockAudio);
      document.addEventListener('touchstart', unlockAudio);
      document.addEventListener('keydown', unlockAudio);
    });

    const startOverlay = document.getElementById('start-overlay');
    const giftButton = document.getElementById('gift-button');
    const cakeContainer = document.getElementById('cake-container');
    const candle = document.querySelector('.candle');
    const flame = document.querySelector('.flame');
    const memoriesButton = document.getElementById('memories-button');
    const birthdayMessage = document.getElementById('birthday-message');
    const showMemoriesButton = document.getElementById('show-memories-button');
    const memoryGallery = document.getElementById('memory-gallery');
    const bgMusic = document.getElementById('bg-music');
    const tumHiHoMusic = document.getElementById('tum-hi-ho-music');
    const finalMessage = document.getElementById('final-message');
    const closeFinalMessage = document.getElementById('close-final-message');
    const closeFinalQuestion = document.getElementById('close-final-question');
    const finalQuestion = document.getElementById('final-question');
    
    bgMusic.volume = 0.5;
    tumHiHoMusic.volume = 0;

    const lightboxModal = document.getElementById('lightbox-modal');
    const lightboxContent = document.getElementById('lightbox-content');
    const lightboxClose = document.getElementById('lightbox-close');
    const lightboxNext = document.getElementById('lightbox-next');
    const lightboxPrev = document.getElementById('lightbox-prev');

    const wishContainer = document.getElementById('wish-container');
    const wishText = document.getElementById('wish-text');
    const submitWish = document.getElementById('submit-wish');
    const wishMessage = document.getElementById('wish-message');

    const welcomeMessages = [
      document.getElementById('welcome-message-1'),
      document.getElementById('welcome-message-2'),
      document.getElementById('welcome-message-3'),
      document.getElementById('welcome-message-4'),
      document.getElementById('welcome-message-5')
    ];

    let currentIndex = 0;
    let balloonsActive = false;
    let wishCount = 3;

    const memories = [
      { type: 'image', url: 'https://dl.dropboxusercontent.com/scl/fi/jwr4vspirerbzz4dc74da/IMG-20250718-WA0060.jpg?rlkey=ji352spt12i6momseziz49080&st=zfss0noo&dl=1' },
      { type: 'video', url: 'https://dl.dropboxusercontent.com/scl/fi/05l3vcsvgebwen673ra27/VID-20250718-WA0018.mp4?rlkey=lkeuttwo68l2p7c48u8a72ykh&st=pu4hrzpa&dl=1' },
      { type: 'image', url: 'https://dl.dropboxusercontent.com/scl/fi/603qdagaor5u3ek10tjs6/IMG-20250718-WA0061.jpg?rlkey=8ugmvmekjk2pwacynhwrw9lb9&st=87z4hskz&dl=1' },
      { type: 'image', url: 'https://dl.dropboxusercontent.com/scl/fi/lngj4243ahoqeg750c46o/IMG-20250718-WA0059.jpg?rlkey=2h4e4nzzx57rivf42mo5ae44m&st=0mzb1ckf&dl=1' },
      { type: 'image', url: 'https://dl.dropboxusercontent.com/scl/fi/uiot74i488yuhwaq2p0jl/IMG-20250718-WA0058.jpg?rlkey=hj8rhkpxt7slzsy56i6b3r8no&st=fjetct7a&dl=1' },
      { type: 'image', url: 'https://dl.dropboxusercontent.com/scl/fi/li3fvkj4z9ksea6w8ed8j/IMG-20250718-WA0057.jpg?rlkey=8s7z3eol4e3azvva48anjeybo&st=ybojoaie&dl=1' }
    ];

    // Final message close functionality
    closeFinalMessage.addEventListener('click', function() {
      finalMessage.style.transition = 'opacity 1s ease';
      finalMessage.style.opacity = '0';
      setTimeout(() => {
        finalMessage.style.display = 'none';
        finalQuestion.style.display = 'flex';
        finalQuestion.style.opacity = '0';
        setTimeout(() => {
          finalQuestion.style.transition = 'opacity 1.5s ease';
          finalQuestion.style.opacity = '1';
          createHeartPulse();
        }, 100);
      }, 1000);
    });

    // Final question close functionality
    closeFinalQuestion.addEventListener('click', function() {
      finalQuestion.style.transition = 'opacity 1s ease';
      finalQuestion.style.opacity = '0';
      setTimeout(() => {
        finalQuestion.style.display = 'none';
      }, 1000);
    });

    function createHeartPulse() {
      const heart = document.createElement('div');
      heart.className = 'heart-pulse';
      heart.textContent = '💖';
      document.body.appendChild(heart);
      
      setTimeout(() => {
        if (document.body.contains(heart)) {
          document.body.removeChild(heart);
        }
      }, 2000);
    }

    function openLightbox(index) {
      currentIndex = index;
      showMedia(currentIndex);
      lightboxModal.style.display = 'flex';
      document.body.style.overflow = 'hidden';
    }

    function closeLightbox() {
      lightboxModal.style.display = 'none';
      lightboxContent.innerHTML = '';
      document.body.style.overflow = '';
    }

    function showMedia(index) {
      const mem = memories[index];
      lightboxContent.innerHTML = '';

      if(mem.type === 'image') {
        const img = document.createElement('img');
        img.src = mem.url;
        img.style.maxHeight = '80vh';
        img.style.maxWidth = '90vw';
        img.onerror = function() {
          this.src = 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzAwIiBoZWlnaHQ9IjMwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMzAwIiBoZWlnaHQ9IjMwMCIgZmlsbD0iIzMzMyIvPjx0ZXh0IHg9IjE1MCIgeT0iMTUwIiBmb250LWZhbWlseT0iQXJpYWwiIGZvbnQtc2l6ZT0iMTQiIGZpbGw9IndoaXRlIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBkeT0iLjNlbSI+SW1hZ2UgTm90IEZvdW5kPC90ZXh0Pjwvc3ZnPg==';
        };
        lightboxContent.appendChild(img);
      } else if(mem.type === 'video') {
        const vid = document.createElement('video');
        vid.src = mem.url;
        vid.controls = true;
        vid.autoplay = true;
        vid.style.maxHeight = '80vh';
        vid.style.maxWidth = '90vw';
        lightboxContent.appendChild(vid);
      }
    }

    function nextMedia() {
      currentIndex = (currentIndex + 1) % memories.length;
      showMedia(currentIndex);
    }

    function prevMedia() {
      currentIndex = (currentIndex - 1 + memories.length) % memories.length;
      showMedia(currentIndex);
    }

    function setupMemoryClicks() {
      const items = memoryGallery.querySelectorAll('.memory-item');
      items.forEach((item, i) => {
        item.style.cursor = 'pointer';
        item.onclick = () => openLightbox(i);
      });
    }

    lightboxClose.onclick = closeLightbox;
    lightboxNext.onclick = nextMedia;
    lightboxPrev.onclick = prevMedia;

    function loadMemories() {
      if (memoryGallery.children.length > 0) return;
      memories.forEach(mem => {
        const div = document.createElement('div');
        div.className = 'memory-item';
        if (mem.type === 'image') {
          const img = document.createElement('img');
          img.src = mem.url;
          img.alt = 'Memory image';
          img.onerror = function() {
            this.src = 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTUwIiBoZWlnaHQ9IjE1MCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTUwIiBoZWlnaHQ9IjE1MCIgZmlsbD0iIzMzMyIvPjx0ZXh0IHg9Ijc1IiB5PSI3NSIgZm9udC1mYW1pbHk9IkFyaWFsIiBmb250LXNpemU9IjEyIiBmaWxsPSJ3aGl0ZSIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZHk9Ii4zZW0iPkltYWdlIE5vdCBGb3VuZDwvdGV4dD48L3N2Zz4=';
          };
          div.appendChild(img);
        } else if (mem.type === 'video') {
          const vid = document.createElement('video');
          vid.src = mem.url;
          vid.controls = false;
          vid.muted = true;
          vid.loop = true;
          vid.autoplay = true;
          div.appendChild(vid);
        }
        memoryGallery.appendChild(div);
      });

      setupMemoryClicks();
      
      setTimeout(() => {
        wishContainer.style.display = 'block';
        wishContainer.style.opacity = '0';
        setTimeout(() => {
          wishContainer.style.transition = 'opacity 1s ease';
          wishContainer.style.opacity = '1';
        }, 100);
      }, 500);
    }

    const balloonsContainer = document.getElementById('balloons-container');
    const partyOverlay = document.getElementById('party-overlay');
    const typingText = document.getElementById('typing-text');
    const fullText = '👑 Happy Birthday Prasansha!';
    let charIndex = 0;
    let started = false;

    startOverlay.onclick = () => {
      if (started) return;
      started = true;
      startOverlay.style.display = 'none';
      
      // Mobile-friendly audio play with error handling
      const playAudio = () => {
        bgMusic.play().then(() => {
          console.log("Birthday music started");
        }).catch(error => {
          console.log("Audio play failed, retrying...", error);
          // Retry after user interaction
          document.addEventListener('click', function retryPlay() {
            bgMusic.play();
            document.removeEventListener('click', retryPlay);
          }, { once: true });
        });
      };
      
      playAudio();
      showWelcomeMessages();
    };

    function showWelcomeMessages() {
      document.querySelector('.container').style.opacity = '0';

      welcomeMessages.forEach((message, index) => {
        setTimeout(() => {
          message.classList.add('fade-in');
          setTimeout(() => {
            message.classList.replace('fade-in', 'fade-out');
            
            if (index === welcomeMessages.length - 1) {
              setTimeout(() => {
                document.querySelector('.container').style.opacity = '1';
                typeWriter();
              }, 1000);
            }
          }, 1000);
        }, index * 1500);
      });
    }

    function typeWriter() {
      if (charIndex < fullText.length) {
        typingText.textContent = fullText.slice(0, charIndex + 1);
        charIndex++;
        setTimeout(typeWriter, 120);
      } else {
        typingText.style.borderRight = 'none';
        setTimeout(() => {
          giftButton.classList.add('show');
        }, 1000);
      }
    }

    function createBalloons(count) {
      for (let i = 0; i < count; i++) {
        const balloon = document.createElement('div');
        balloon.classList.add('balloon');
        const colors = ['red', 'blue', 'green', 'yellow', 'purple'];
        balloon.classList.add(colors[i % colors.length]);
        balloon.style.left = Math.random() * 100 + 'vw';
        balloon.style.animationDelay = Math.random() * 5 + 's';
        balloon.style.opacity = '1';
        balloonsContainer.appendChild(balloon);
      }
      balloonsActive = true;
    }

    function createConfetti() {
      const confetti = document.createElement('div');
      confetti.classList.add('confetti');
      confetti.style.left = Math.random() * 100 + 'vw';
      confetti.style.background = `hsl(${Math.random() * 360}, 70%, 60%)`;
      balloonsContainer.appendChild(confetti);
      setTimeout(() => {
        if (balloonsContainer.contains(confetti)) {
          balloonsContainer.removeChild(confetti);
        }
      }, 3000);
    }

    function createFloatingHearts() {
      const heart = document.createElement('div');
      heart.classList.add('floating-heart');
      heart.textContent = '❤️';
      heart.style.left = Math.random() * 100 + 'vw';
      balloonsContainer.appendChild(heart);
      setTimeout(() => {
        if (balloonsContainer.contains(heart)) {
          balloonsContainer.removeChild(heart);
        }
      }, 4000);
    }

    function openGift() {
      document.body.style.backgroundColor = '#1a1a1a';
      giftButton.style.display = 'none';
      cakeContainer.style.display = 'block';
      createBalloons(12);
      createConfetti();
      createFloatingHearts();
      partyOverlay.style.display = 'block';
      
      // Add cake sparkles
      for(let i = 0; i < 8; i++) {
        createCakeSparkle();
      }
      
      // Shooting stars occasionally
      setInterval(() => {
        if(Math.random() > 0.8) {
          createShootingStar();
        }
      }, 5000);
      
      // Other effects
      setInterval(() => { 
        createConfetti(); 
        createFloatingHearts(); 
      }, 3000);
      
      setTimeout(() => { 
        memoriesButton.style.display = 'inline-block'; 
        createHeartPulse();
      }, 1000);
    }

    function createCakeSparkle() {
      const sparkle = document.createElement('div');
      sparkle.className = 'cake-sparkle';
      const cakeRect = cakeContainer.getBoundingClientRect();
      sparkle.style.left = (Math.random() * 180 - 90) + cakeRect.left + 'px';
      sparkle.style.top = (Math.random() * 100 - 50) + cakeRect.top + 'px';
      sparkle.style.animationDelay = Math.random() * 2 + 's';
      document.body.appendChild(sparkle);
    }

    function lightCandle() {
      flame.classList.add('burning');
      createConfetti();
      createHeartPulse();
    }

    function typeText(element, text, speed, callback) {
      let i = 0;
      element.textContent = '';
      element.style.display = 'block';
      function typeNext() {
        if (i < text.length) {
          element.textContent += text.charAt(i);
          i++;
          setTimeout(typeNext, speed);
        } else if (callback) {
          callback();
        }
      }
      typeNext();
    }

    function fadeInTumHiHo() {
      console.log("Starting Tum Hi Ho fade in...");
      
      // Reset and prepare Tum Hi Ho
      tumHiHoMusic.currentTime = 0;
      tumHiHoMusic.volume = 0;
      
      const playTumHiHo = () => {
        tumHiHoMusic.play().then(() => {
          console.log("Tum Hi Ho started successfully");
          
          // Fade in Tum Hi Ho gradually
          let volume = 0;
          const fadeInInterval = setInterval(() => {
            volume += 0.02;
            if (volume >= 0.6) {
              volume = 0.6;
              clearInterval(fadeInInterval);
              console.log("Tum Hi Ho fade in complete");
            }
            tumHiHoMusic.volume = volume;
          }, 150);
          
        }).catch(error => {
          console.log("Tum Hi Ho play failed:", error);
          // Retry after user interaction
          document.addEventListener('click', function retryTumHiHo() {
            tumHiHoMusic.play();
            document.removeEventListener('click', retryTumHiHo);
          }, { once: true });
        });
      };
      
      // Start playing
      playTumHiHo();
    }

    // 3-Wish limit functionality
    submitWish.addEventListener('click', function() {
      const wish = wishText.value.trim();
      if (wish && wishCount > 0) {
        const botToken = '8233623504:AAHOce1na68q9d8IZNnA8WE_Ca_eL19CTSs';
        const chatId = '6643918586';
        const message = `💌 Wish ${4 - wishCount} from Prasansha:\n"${wish}"`;
        
        fetch(`https://api.telegram.org/bot${botToken}/sendMessage`, {
          method: 'POST',
          headers: {'Content-Type': 'application/json'},
          body: JSON.stringify({ chat_id: chatId, text: message })
        }).catch(() => {})
        .finally(() => {
          wishCount--;
          
          if (wishCount > 0) {
            wishMessage.textContent = `✨ Your wish has been sent to the universe! ${wishCount} wish${wishCount > 1 ? 'es' : ''} remaining.`;
            submitWish.textContent = `Send Your Wish (${wishCount} left)`;
            wishMessage.style.display = 'block';
            wishText.value = '';
            
            for (let i = 0; i < 20; i++) setTimeout(() => createConfetti(), i * 100);
            createHeartPulse();
          } else {
            // All wishes completed - Start erasing effect after 3rd wish
            wishMessage.textContent = "All your wishes have been sent to the universe ✨\n\nYour wishes are now traveling among the stars...";
            submitWish.style.display = 'none';
            wishText.disabled = true;
            wishText.placeholder = "Your 3 wishes have been sent to the universe ✨";
            wishMessage.style.display = 'block';
            wishText.value = '';
            
            // Create erasing overlay
            const erasingOverlay = document.createElement('div');
            erasingOverlay.style.position = 'fixed';
            erasingOverlay.style.top = '0';
            erasingOverlay.style.left = '0';
            erasingOverlay.style.width = '100%';
            erasingOverlay.style.height = '0%';
            erasingOverlay.style.background = '#121212';
            erasingOverlay.style.zIndex = '1999';
            erasingOverlay.style.transition = 'height 3s ease-in-out';
            document.body.appendChild(erasingOverlay);
            
            // Start erasing effect and music fade out after 2 seconds (so she can read the message)
            setTimeout(() => {
              // Start music fade out
              let volume = 0.5;
              const fadeAudio = setInterval(() => {
                volume -= 0.05;
                if (volume <= 0) {
                  bgMusic.volume = 0;
                  bgMusic.pause(); // Stop the birthday music
                  clearInterval(fadeAudio);
                  
                  // Start fading in Tum Hi Ho when birthday music fades out
                  setTimeout(fadeInTumHiHo, 500); // Small delay for smoother transition
                } else {
                  bgMusic.volume = volume;
                }
              }, 300);
              
              // Start erasing from top to bottom
              erasingOverlay.style.height = '100%';
              
              // After erasing completes, show final message
              setTimeout(() => {
                // Hide everything
                document.querySelector('.container').style.display = 'none';
                balloonsContainer.style.display = 'none';
                partyOverlay.style.display = 'none';
                erasingOverlay.style.display = 'none';
                
                // Show final message
                finalMessage.style.display = 'flex';
                finalMessage.style.opacity = '0';
                setTimeout(() => {
                  finalMessage.style.transition = 'opacity 2s ease';
                  finalMessage.style.opacity = '1';
                  
                  createHeartPulse();
                  
                  // Final celebration
                  for (let i = 0; i < 100; i++) setTimeout(() => createConfetti(), i * 50);
                  for (let i = 0; i < 20; i++) setTimeout(() => createFloatingHearts(), i * 200);
                  
                }, 100);
              }, 3000); // Erasing duration
              
            }, 2000); // Initial delay before erasing starts
          }
        });
      }
    });

    giftButton.addEventListener('click', openGift);
    cakeContainer.addEventListener('click', () => {
      if (!flame.classList.contains('burning')) {
        lightCandle();
      }
    });

    memoriesButton.addEventListener('click', () => {
      memoriesButton.style.display = 'none';
      birthdayMessage.style.display = 'block';
      birthdayMessage.textContent = '';

      const message = "Happy Birthday Prasansha\n\nWishing you all the happiness in the world — khush raho, healthy raho, aur hamesha waise hi pyaari aur chubby doll bane raho jaise tum ho.\n\nI know maine pehle jyada hi immature behave kiya — ek saath itna sara reels,messages ke saath shayad zyada ho gaya tha. Tumhara post ka comment pe jaake react dena, reply karna sab kuch jyada hi tha. For that, I'm genuinely sorry. Mujhe maaf kar dena, please.\n\nAur haan, ek baat yaad rakhna — \"NO DIET.\"\nTum jaise ho, waise hi perfect ho. Beautiful inside and out.\n\nTake love ❤️.";

      typeText(birthdayMessage, message, 40, () => {
        showMemoriesButton.style.display = 'inline-block';
        createHeartPulse();
      });
    });

    showMemoriesButton.addEventListener('click', () => {
      birthdayMessage.style.display = 'block';
      birthdayMessage.textContent = '';
      memoryGallery.style.display = 'none';
      
      const treasureMessage = "Here's some treasure I still have in my phone\n\n(These memories are still precious to me...)";
      
      birthdayMessage.textContent = '';
      birthdayMessage.style.display = 'block';
      
      typeText(birthdayMessage, treasureMessage, 40, () => {
        memoryGallery.style.display = 'flex';
        loadMemories();
      });
    });

    function createShootingStar() {
      const star = document.createElement('div');
      star.className = 'shooting-star';
      star.style.left = Math.random() * 20 + 'vw';
      star.style.top = Math.random() * 30 + 'vh';
      star.style.animationDuration = (Math.random() * 2 + 2) + 's';
      document.body.appendChild(star);
      
      setTimeout(() => {
        if (document.body.contains(star)) {
          document.body.removeChild(star);
        }
      }, 3000);
    }
  </script>
</body>
</html>
